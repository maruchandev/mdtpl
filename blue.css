@media print {
    /* ページマージン設定 */
    @page {
        margin: 2cm 1.5cm;
        size: A4;
    }

    /* 見出しのページブレーク制御 */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        page-break-after: avoid;
        page-break-inside: avoid;
        break-after: avoid;
        break-inside: avoid;
        page-break-before: auto;   /* ←ここを追加 */
        break-before: auto;        /* ←ここを追加 */
    }

    /* 最初のh1だけは改ページしない（元々OK） */
    body > h1:first-of-type {
        page-break-before: avoid;
        break-before: avoid;
    }

    /* 見出しの直後の要素が次のページに行かないようにする */
    h1+*,
    h2+*,
    h3+*,
    h4+*,
    h5+*,
    h6+* {
        page-break-before: avoid;
        break-before: avoid;
    }

    /* 分割を避けるべき要素 */
    table,
    figure,
    pre,
    blockquote,
    .note,
    .important,
    .warning,
    ul,
    ol {
        page-break-inside: avoid;
        break-inside: avoid;
    }

    /* 画像の前後で改ページしない */
    img {
        max-width: 100% !important;
        page-break-before: avoid;
        page-break-after: avoid;
        break-before: avoid;
        break-after: avoid;
    }

    /* 孤立行と未亡人行の制御 */
    p,
    li {
        orphans: 3;
        widows: 3;
    }

    /* 強制改ページクラス */
    .page-break {
        page-break-before: always;
        break-before: page;
    }

    /* 各章の始まりで改ページしたい場合は .chapter クラスを使う */
    .chapter {
        page-break-before: always;
        break-before: page;
    }
}
